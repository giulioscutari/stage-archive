services:
  backend:
    build:
      args:
        USER: ${USER:-appuser}
      context: ./stage-archive-backend
    depends_on:
      - postgres
    user: ${USER:-appuser}
    volumes:
      - ./static:/app/static
      - ./stage-archive-backend/:/app/
    command:  "python3 -m manage runserver 0:8000"
    ports:
      - 8000:8000

  frontend:
    image: giulios/flutter-ready:latest
    volumes:
      - frontend_code:/app/flutter_application
    ports:
      - 5000:5000
  postgres:
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
    image: postgres:14-bullseye
    volumes:
      - pg_data:/var/lib/postgresql/data

volumes:
  pg_data: {}
  staticfiles: {}
  frontend_code: 
    driver: local
    driver_opts:
      type: none
      device: ./stage-archive-frontend
      o: bind